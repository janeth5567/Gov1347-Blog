"0","# Selecting columns"
"0","avg_ratings <- expert_ratings %>% "
"0","  select(year, state, district, avg_rating)"
"0",""
"0","dem_results <- historical_results %>% "
"0","  select(race_year, state, area, dem_votes_major_percent) %>% "
"0","  rename(""year"" = ""race_year"") %>% "
"0","  separate(area, into = c(""area"", ""district""), sep = "" "") %>% "
"0","  select(-area) %>% "
"0","  mutate(district = case_when("
"0","    district == ""Large"" ~ ""AL"","
"0","    TRUE ~ district"
"0","  ))"
"0",""
"0","# Joining the data and nesting by state and district"
"0","train_data <- avg_ratings %>% "
"0","  filter(year != 2022) %>% "
"0","  # left join as there aren't ratings for every district"
"0","  left_join(dem_results, by = c(""year"", ""state"", ""district"")) %>% "
"0","  group_by(state, district) %>% "
"0","  filter(n() > 1) %>% # Filtering out single data rows"
"0","  group_nest() %>% "
"0","  mutate(data = map(data, ~unnest(., cols = c())))"
"0",""
"0","test_data <- avg_ratings %>% "
"0","  filter(year == 2022) %>% "
"0","  group_by(state, district) %>% "
"0","  group_nest() %>% "
"0","  mutate(data = map(data, ~unnest(., cols = c())))"
