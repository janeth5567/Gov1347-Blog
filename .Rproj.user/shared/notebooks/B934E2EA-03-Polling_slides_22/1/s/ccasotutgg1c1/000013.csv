"0","# # polling margin winning party - within-party - Nov-Jan"
"0","pn_df <- pollnov_df %>%"
"0","  left_join(popvote_df, by = c(""year""=""year"", ""party""=""party"")) %>%"
"0","   filter(emonth != '12') %>%"
"0","   group_by(emonth, year) %>%"
"0","   mutate(winner_support = case_when(winner_party == 'R' "
"0","                             & party == 'R' ~ support,"
"0","                             winner_party == 'D' "
"0","                            & party == 'D' ~ support)) %>%"
"0","   group_by(year) %>% "
"0","   mutate(pv2p_margin=abs(first(majorvote_pct)-last(majorvote_pct)), "
"0","         pv2p_winner = case_when(winner_party == 'D' ~ votes,"
"0","             TRUE ~ votes)) %>%"
"0","   filter(party == winner_party) %>%"
"0","   mutate(poll_margin=first(support)-last(support))"
"0",""
"0","# polling margin winning party - between-party - in Nov"
"0","pnp_df <- pollnov_df %>%"
"0","  left_join(popvote_df, by = c(""year""=""year"", ""party""=""party"")) %>%"
"0","  filter(emonth == 11) %>%"
"0","  group_by(emonth, year) %>%"
"0","  mutate(winner_support = case_when(winner_party == 'R' "
"0","                            & party == 'R' ~ support,"
"0","                            winner_party == 'D' "
"0","                            & party == 'D' ~ support)) %>%"
"0","  group_by(year) %>% "
"0","  mutate(pv2p_margin=abs(first(majorvote_pct)-last(majorvote_pct)), "
"0","        pv2p_winner = case_when(winner_party == 'D' ~ votes,"
"0","            TRUE ~ votes),"
"0","        poll_margin= case_when(winner_party == 'D' ~ first(support)-last(support),"
"0","                                TRUE ~ last(support)-first(support))) %>%"
"0","    filter(party == winner_party)"
"0",""
"0","# just general preference for winning party"
"0"," prefnov_df <- pollnov_df %>%"
"0","   left_join(popvote_df, by = c(""year""=""year"", ""party""=""party"")) %>%"
"0","   filter(emonth == 11) %>%"
"0","   group_by(emonth, year) %>%"
"0","   mutate(winner_support = case_when(winner_party == 'R' "
"0","                             & party == 'R' ~ support,"
"0","                             winner_party == 'D' "
"0","                             & party == 'D' ~ support)) %>%"
"0","   group_by(year) %>% "
"0","   filter(party == winner_party, poll_date == first(poll_date)) %>%"
"0","   group_by(poll_date) %>%"
"0","     mutate(avg_winner_support = mean(winner_support)) %>%"
"0","   distinct(year, poll_date, winner_support, majorvote_pct)"
"0",""
