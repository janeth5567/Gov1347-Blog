"0","require(sf)"
"0",""
"0","# load geographic data"
"0","get_congress_map <- function(cong=114) {"
"0","tmp_file <- tempfile()"
"0","tmp_dir <- tempdir()"
"0","zp <- sprintf(""https://cdmaps.polisci.ucla.edu/shp/districts114.zip"",cong)"
"0","download.file(zp, tmp_file)"
"0","unzip(zipfile = tmp_file, exdir = tmp_dir)"
"0","fpath <- paste(tmp_dir, sprintf(""districtShapes/districts114.shp"",cong), sep = ""/"")"
"0","st_read(fpath)"
"0","}"
"0",""
"0","# load 114th congress"
"0",""
"0","cd114 <- get_congress_map(114)"
"2","Warning: one argument not used by format 'https://cdmaps.polisci.ucla.edu/shp/districts114.zip'"
"2","trying URL 'https://cdmaps.polisci.ucla.edu/shp/districts114.zip'
"
"2","Content type 'application/zip'"
"2"," length 61656606 bytes (58.8 MB)
"
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","
"
"2","downloaded 58.8 MB

"
"2","Warning: one argument not used by format 'districtShapes/districts114.shp'"
"1","Reading layer `"
"1","districts114"
"1","' from data source "
"1","
"
"1","  "
"1","`"
"1","/private/var/folders/mv/pwxqfd411cz090w_kkkl3mn00000gn/T/Rtmp9vulzR/districtShapes/districts114.shp"
"1","' "
"1","
"
"1","  "
"1","using driver `"
"1","ESRI Shapefile"
"1","'"
"1","
"
"1","Simple feature collection with 436 features and 15 fields"
"1"," (with 1 geometry empty)"
"1","
"
"1","Geometry type: MULTIPOLYGON
"
"1","Dimension:     XY
"
"1","Bounding box:  "
"1","xmin: -179.1473 ymin: 18.91383 xmax: 179.7785 ymax: 71.35256"
"1","
"
"1","Geodetic CRS:  NAD83
"
"0","#Load data just for year 2018 "
"0","house_party_vote_share_by_district <- read_csv(""~/Desktop/Syllabi for Fall 22/election analytics/Gov1347 Data/house party vote share by district 1948-2020.csv"") %>%"
"0","  filter(raceYear == 2018) %>%"
"0","  select(State, raceYear, Area, RepVotesMajorPercent, DemVotesMajorPercent, st_fips, state_abb, CD, district_num, district_id, WinnerParty )"
"2","[1mRows: [22m[34m16067[39m [1mColumns: [22m[34m31[39m"
"2","[36mâ”€â”€[39m [1mColumn specification[22m [36mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m
[1mDelimiter:[22m "",""
[31mchr[39m (16): Office, State, Area, RepCandidate, RepStatus, DemCandidate, DemStatus, ThirdParty, Th...
[32mdbl[39m (14): raceYear, RepVotes, DemVotes, ThirdVotes, OtherVotes, PluralityVotes, ThirdVotesTotal...
[33mlgl[39m  (1): CensusPop"
"2","
[36mâ„¹[39m Use `spec()` to retrieve the full column specification for this data.
[36mâ„¹[39m Specify the column types or set `show_col_types = FALSE` to quiet this message."
"0","# Change from at large states w only one district to a code-able suffix"
"0","house_party_vote_share_by_district$CD[grep(pattern = ""-AL"", x = house_party_vote_share_by_district$CD)] <- c(""AK-01"",""DE-01"",""MT-01"",""ND-01"",""SD-01"", ""VT-01"",""WY-01"")"
"0",""
"0","#Cleaned 2018 data from Ethan  "
"0","ratings_share_2018 <-read.csv(""~/Desktop/2018_ratings.csv"")"
"0",""
"0","house_party_vote_share_by_district <- house_party_vote_share_by_district %>%  "
"0","  inner_join(ratings_share_2018, by = ""CD"") %>%"
"0","  rename(DISTRICT = district_num, STATENAME = State) %>%"
"0","  mutate(DISTRICT = as.character(DISTRICT),"
"0","         diff = avg_margin - RepVotesMajorPercent)"
"0","cd114 <- cd114 %>% left_join(house_party_vote_share_by_district, by=c(""DISTRICT"", ""STATENAME""))"
"0",""
"0","districts_simp <- rmapshaper::ms_simplify(cd114, keep = 0.01)"
